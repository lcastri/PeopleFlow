session: TIAGo
init_cmd: |
  echo " "
  echo " "
  echo " "
  echo "Running Initialisation" | awk '{ gsub("Running Initialisation", "\033[1;21m\033[1;30m&\033[0m"); print }' ;

  #exec /bin/bash
  cd @TMULE_CONFIG_DIR@ || true
  set -o pipefail
  function export_default () {
    var_name="$1"
    var_default="$2"
    eval $var_name="${!var_name:-$var_default}"
    export $var_name
    echo "  $0 -> $var_name=${!var_name}"
  }

  # source ROS
  source "/opt/ros/$(rosversion -d)/setup.bash"

  # source the tiago catkin workspace
  source "$HOME/.bashrc"
  export_default CATKIN_WS "$HOME/ros_ws"

  # robot specific arguments
  export_default ABORT_TIMEOUT "30"
  export_default RECORD "false"
  export_default SCENARIO "S2"
  export_default DURATION "120"

  # world arguments
  # choose a map between: maze, maze_corridor, maze_corridor_withTurn, maze_corridor_withDoors
  export_default WORLD "INB-3floor"

  # PNP specific arguments
  export_default PNP_PLANS "$CATKIN_WS/src/HRISim/hrisim_plans"
  export_default PNP_ACTIONS "$CATKIN_WS/src/HRISim/hrisim_actions"
  export_default PNP_CONDITIONS "$CATKIN_WS/src/HRISim/hrisim_conditions"

  # CausalFlow arguments
  # export_default CIE "CIE"
  # export_default PRED_STEP "5"

windows:
  - name: roscore
    tags: ['core']
    panes:
      - htop
      - 'rviz -d "$(rospack find hrisim_rviz)/config/rviz/tiago_rviz.rviz" --fixed-frame map'
  - name: wp
    tags: ['core']
    panes:
      - 'roslaunch graph_creator graph_publisher.launch graph:=$WORLD'
      - 'roslaunch waypoint_publisher wp_publisher.launch map:=$WORLD'
      - 'rosrun path_visualiser path_visualiser.py'
      - 'rosrun graph_visualiser graph_visualiser.py'
      - 'rosrun weights_visualiser weights_visualiser.py'
  - name: robot
    tags: ['core']
    panes:
      - 'rosrun robot_info robot_displayinfo.py'
      - 'rosrun robot_info robot_closestWP.py'
      - 'rosparam set /hrisim/abort_timeout $ABORT_TIMEOUT && roslaunch robot_wp_navigation Astar_navigation.launch graph:=$WORLD'
  - name: people
    tags: ['core']
    panes:
      - 'rosrun hrisim_people_counter PeopleCounter.py'
  - name: data
    tags: ['exp']
    panes:
      - if [[ "$RECORD" == "true" ]]; then rosrun hrisim_recording record.py; fi
  - name: planning
    tags: ['core']
    panes:
      - 'roslaunch pnp_ros pnp_ros.launch plans_folder:=$PNP_PLANS actions_folder:=$PNP_ACTIONS conditions_folder:=$PNP_CONDITIONS'
      # - 'cd ~/ros_ws/src/HRISim/hrisim_plans/scripts; echo -e "\033[1;31mStart your plan here: python <PLAN-NAME>.py\033[0m"'
      - |
          cd ~/ros_ws/src/HRISim/hrisim_plans/scripts
          if [ "$RECORD" = "true" ]; then
            python record_data.py $SCENARIO $DURATION
          else
            echo -e "\033[1;31mStart your plan here: python <PLAN-NAME>.py\033[0m"
          fi
  # - name: prediction
  #   tags: ['exp']
  #   panes:
  #     - 'roslaunch hrisim_prediction_manager prediction_manager.launch CIE:=$CIE pred_step:=$PRED_STEP'