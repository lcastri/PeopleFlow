session: TIAGo
init_cmd: |
  echo " "
  echo " "
  echo " "
  echo "Running Initialisation" | awk '{ gsub("Running Initialisation", "\033[1;21m\033[1;30m&\033[0m"); print }' ;

  #exec /bin/bash
  cd @TMULE_CONFIG_DIR@ || true
  set -o pipefail
  function export_default () {
    var_name="$1"
    var_default="$2"
    eval $var_name="${!var_name:-$var_default}"
    export $var_name
    echo "  $0 -> $var_name=${!var_name}"
  }

  # source ROS
  source "/opt/ros/$(rosversion -d)/setup.bash"

  # source the tiago catkin workspace
  source "$HOME/.bashrc"
  export_default CATKIN_WS "$HOME/ros_ws"

  # robot specific arguments
  export_default ABORT_TIMEOUT "45"
  export_default RECORD "false"
  export_default SCENARIO "S1"
  export_default DURATION "300"

  # world arguments
  # choose a map between: maze, maze_corridor, maze_corridor_withTurn, maze_corridor_withDoors
  export_default WORLD "INB-3floor"

  # PNP specific arguments
  export_default PNP_PLANS "$CATKIN_WS/src/HRISim/hrisim_plans"
  export_default PNP_ACTIONS "$CATKIN_WS/src/HRISim/hrisim_actions"
  export_default PNP_CONDITIONS "$CATKIN_WS/src/HRISim/hrisim_conditions"

  # CausalFlow arguments
  # export_default CIE "CIE3.8"
  # export_default PRED_STEP "5"

windows:
  - name: roscore
    tags: ['core']
    panes:
      - htop
      - 'rviz -d "$(rospack find hrisim_rviz)/config/rviz/tiago_rviz.rviz" --fixed-frame map'
  - name: wp
    tags: ['core']
    panes:
      - 'roslaunch graph_creator graph_publisher.launch graph:=$WORLD'
      - 'roslaunch waypoint_publisher wp_publisher.launch map:=$WORLD'
      - 'rosrun path_visualiser path_visualiser.py'
      - 'rosrun graph_visualiser graph_visualiser.py'
  - name: robot
    tags: ['core']
    panes:
      - 'rosrun robot_info robot_displayinfo.py'
      - 'rosrun robot_info robot_closestWP.py'
      - 'rosparam set /hrisim/abort_timeout $ABORT_TIMEOUT && roslaunch robot_wp_navigation Astar_navigation.launch graph:=$WORLD'
  - name: people
    tags: ['core']
    panes:
      - 'rosrun hrisim_people_counter PeopleCounter.py'
  - name: data
    tags: ['exp']
    panes:
      - if [[ "$RECORD" == "true" ]]; then rosrun hrisim_recording record.py; fi
  - name: planning
    tags: ['core']
    panes:
      - 'roslaunch pnp_ros pnp_ros.launch plans_folder:=$PNP_PLANS actions_folder:=$PNP_ACTIONS conditions_folder:=$PNP_CONDITIONS'
      # - 'cd ~/ros_ws/src/HRISim/hrisim_plans/scripts; echo -e "\033[1;31mStart your plan here: python <PLAN-NAME>.py\033[0m"'
      - |
          cd ~/ros_ws/src/HRISim/hrisim_plans/scripts
          if [ "$RECORD" = "true" ]; then
            python record_data.py $SCENARIO $DURATION
          else
            echo -e "\033[1;31mStart your plan here: python <PLAN-NAME>.py\033[0m"
          fi
  # - name: prediction
  #   tags: ['exp']
  #   panes:
  #     - 'roslaunch hrisim_prediction_manager prediction_manager.launch CIE:=$CIE pred_step:=$PRED_STEP'

  # - name: robot
    # tags: ['robot']
    # panes:
      # - 'rosrun robot_info robot_closestWP.py'
      # - 'roslaunch robot_clearing_distance clearing_distance.launch'
      # - 'rosrun robot_task TaskInfoManager.py'
      # - 'rosrun robot_path_visualisation AstarVisualisation.py'
  # - name: obstacle
  #   tags: ['obs']
  #   panes: 
  #     - 'rosrun robot_obs DynamicObstacle.py'
  # - name: scenario
  #   tags: ['exp']
  #   panes:
  #     - 'roslaunch peopleflow_manager peopleflow_manager.launch scenario:=$SCENARIO starting_elapsed:=$STARTING_ELAPSED'
  #     - 'roslaunch peopleflow_pedsim_bridge peopleflow_pedsim.launch scenario:=$SCENARIO allow_task:=$ALLOW_TASK max_tasktime:=$MAX_TASKTIME'
  #     - 'roslaunch pedsim_simulator mysimulator.launch scenario:=$SCENARIO robot_mode:=$HUMAN_MODE max_robot_speed:=$MAX_HUMAN_SPEED robot_radius:=$ROBOT_RADIUS is_stuck_threshold:=$IS_STUCK_THRESHOLD force_obstacle:=$FORCE_OBSTACLE sigma_obstacle:=$SIGMA_OBSTACLE force_social:=$FORCE_SOCIAL with_teleop_ped:=$WITH_TELEOP_PED ped_x:=$HUMAN_x ped_y:=$HUMAN_y ped_theta:=0'
  #     - 'rosrun rqt_peopleflow agents_info.py'
  #     - 'rosrun peopleflow_counter PeopleCounter.py'
  #     - 'rosrun peopleflow_graph_visualisation GraphVisualisation.py'
  # - name: data
  #   tags: ['exp']
  #   panes:
  #     - if [[ "$RECORD" == "true" ]]; then rosrun hrisim_recording record.py; fi
  # - name: prediction
  #   tags: ['exp']
  #   panes:
  #     - 'roslaunch hrisim_prediction_manager prediction_manager.launch CIE:=$CIE pred_step:=$PRED_STEP'